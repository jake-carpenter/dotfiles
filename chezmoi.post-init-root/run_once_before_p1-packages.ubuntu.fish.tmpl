#!/usr/bin/env fish

# Hash the packages file to trigger a change here when there's a change there.
# packages.yaml hash: {{ include ".chezmoidata/packages.yaml" | sha256sum }}

{{ if ne .chezmoi.osRelease.id "ubuntu" }}
  exit 0
{{ end }}

echo
echo "ðŸš€ Applying PPAs/repositories and installing packages for Ubuntu"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

{{ range .packages.ubuntu.base.repos }}
  set repo {{ . }}
  if not grep -Rq -- "$repo" /etc/apt/sources.list /etc/apt/sources.list.d/
    echo "Adding repository: $repo"
    sudo add-apt-repository -y {{ . | quote }}
  end
{{ end }}

sudo apt update

# This doesn't handle system profiles for Ubuntu yet.
set packages

{{ range .packages.ubuntu.base.packages }}
  set -a packages {{ . | quote }}
{{ end }}

if test (count $packages) -gt 0
  echo "Installing packages: $packages"
  sudo apt install -y $packages
else
  echo "No packages to install."
end
